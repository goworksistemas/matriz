Dax de cada tabela: 

Tabela de negocios:

let
    // 1. Carrega o conteúdo do arquivo JSON a partir do URL
    Fonte = Json.Document(Web.Contents("http://161.35.104.75:8001/download/Hubspot/negocios/negocios_hubspot.json")),

    // 2. Converte a lista de registros JSON em uma tabela do Power Query
    #"Tabela da Lista" = Table.FromList(Fonte, Splitter.SplitByNothing(), null, null, ExtraValues.Error),

    // 3. Expande as colunas de primeiro nível do JSON
    #"Colunas Iniciais Expandidas" = Table.ExpandRecordColumn(
        #"Tabela da Lista", "Column1",
        {"id", "properties", "createdAt", "updatedAt", "archived"},
        {"ID do Negócio", "properties", "Data de Criação (UTC)", "Data de Atualização (UTC)", "Arquivado"}
    ),

    // 4. Expande a coluna "properties" que contém todos os detalhes do negócio
    #"Propriedades Expandidas" = Table.ExpandRecordColumn(
        #"Colunas Iniciais Expandidas", "properties",
        {
            "dealname", "amount", "closedate", "pipeline", "dealstage", "hubspot_owner_id",
            "hs_is_closed_won", // <-- CAMPO ADICIONADO AQUI
            "andar", "cargo", "conte_o_motivo_de_nao_fechar_na_hora", "data_de_assinatura_do_layout",
            "documento_do_titular_da_conta_bancaria___cpf_cnpj_", "e_mail_envio_de_boleto",
            "endereco__bairro_regiao", "endereco__cep", "endereco__cidade", "endereco__numero",
            "endereco__pais", "endereco__rua", "endereco__uf", "expectativa_de_entrada",
            "e_venda_de_impacto_", "layout_assinado", "numero_do_espaco",
            "o_que_e_prioridade_para_escolher_o_local_", "onde_esta_atualmente_", "produto",
            "provisorio", "quantas_seats__teste_", "segmento", "tempo_de_contrato",
            "tentei_fechar_na_hora", "tipo_de_fechamento", "unidade", "urgencia",
            "voce_adicionou_o_produto__itens_por_linha__"
        },
        {
            "Nome do Negócio", "Valor", "Data de Fechamento", "Pipeline ID", "Etapa ID", "Proprietário ID",
            "Negócio Ganho", // <-- NOME AMIGÁVEL ADICIONADO AQUI
            "Andar", "Cargo", "Motivo Não Fechamento na Hora", "Data Assinatura Layout",
            "Documento Titular (CPF/CNPJ)", "Email Envio Boleto",
            "Endereço: Bairro/Região", "Endereço: CEP", "Endereço: Cidade", "Endereço: Número",
            "Endereço: País", "Endereço: Rua", "Endereço: UF", "Expectativa de Entrada",
            "É Venda de Impacto?", "Layout Assinado", "Número do Espaço",
            "Prioridade Escolha Local", "Onde Está Atualmente", "Produto",
            "Provisório", "Qtd Posições de Trabalho", "Segmento", "Tempo de Contrato",
            "Tentei Fechar na Hora", "Tipo de Fechamento", "Unidade", "Urgência",
            "Adicionou Produto (Itens por Linha)?"
        }
    ),

    // 5. Converte as colunas de data de forma segura
    #"Tipos de Data Corrigidos" = Table.TransformColumns(#"Propriedades Expandidas",{
        {"Data de Fechamento", each try Date.From(DateTimeZone.From(_)) otherwise null, type nullable date},
        {"Expectativa de Entrada", each try Date.From(DateTimeZone.From(_)) otherwise null, type nullable date},
        {"Data Assinatura Layout", each try Date.From(DateTimeZone.From(_)) otherwise null, type nullable date}
    }),

    // 6. Altera os tipos das outras colunas para os formatos corretos
    #"Tipos Finais Alterados" = Table.TransformColumnTypes(
        #"Tipos de Data Corrigidos",
        {
            {"Data de Criação (UTC)", type datetimezone},
            {"Data de Atualização (UTC)", type datetimezone},
            {"Valor", Currency.Type},
            {"Tempo de Contrato", Int64.Type},
            {"Qtd Posições de Trabalho", Int64.Type},
            {"ID do Negócio", type text},
            {"Negócio Ganho", Logical.Type} // <-- TIPO LÓGICO (TRUE/FALSE) ADICIONADO AQUI
        }
    )

in
    #"Tipos Finais Alterados"


    tabela de pipeline: 

    let
    // 1. Carrega o arquivo JSON do URL
    Fonte = Json.Document(Web.Contents("http://161.35.104.75:8001/download/Hubspot/pipeline/pipelines_hubspot.json")),

    // 2. Converte a lista de registros em uma tabela
    #"Tabela da Lista" = Table.FromList(Fonte, Splitter.SplitByNothing(), null, null, ExtraValues.Error),

    // 3. Expande as colunas do JSON (id e nome do pipeline, id e nome da etapa)
    #"Colunas Expandidas" = Table.ExpandRecordColumn(
        #"Tabela da Lista", "Column1",
        {"pipeline_id", "pipeline_name", "stage_id", "stage_name"},
        {"Pipeline ID", "Nome do Pipeline", "Etapa ID", "Nome da Etapa"}
    ),

    // 4. Ajusta os tipos de dados para texto (ideal para chaves de relacionamento)
    #"Tipos Alterados" = Table.TransformColumnTypes(
        #"Colunas Expandidas",
        {
            {"Pipeline ID", type text},
            {"Nome do Pipeline", type text},
            {"Etapa ID", type text},
            {"Nome da Etapa", type text}
        }
    )
in
    #"Tipos Alterados"


    tabela de Proprietarios:

    let
    // 1. Carrega o arquivo JSON do URL
    Fonte = Json.Document(Web.Contents("http://161.35.104.75:8001/download/Hubspot/proprietario/proprietarios_hubspot.json")),

    // 2. Converte a lista de registros em uma tabela
    #"Tabela da Lista" = Table.FromList(Fonte, Splitter.SplitByNothing(), null, null, ExtraValues.Error),

    // 3. Expande as colunas do JSON (id, nome, sobrenome, email)
    #"Colunas Expandidas" = Table.ExpandRecordColumn(
        #"Tabela da Lista", "Column1",
        {"ownerId", "firstName", "lastName", "email"},
        {"Proprietário ID", "Nome", "Sobrenome", "Email"}
    ),

    // 4. (Opcional) Cria uma coluna com o nome completo
    #"Nome Completo Adicionado" = Table.AddColumn(
        #"Colunas Expandidas", "Nome Completo",
        each [Nome] & " " & [Sobrenome], type text
    ),

    // 5. Ajusta os tipos de dados para texto
    #"Tipos Alterados" = Table.TransformColumnTypes(
        #"Nome Completo Adicionado",
        {
            {"Proprietário ID", type text},
            {"Nome", type text},
            {"Sobrenome", type text},
            {"Email", type text}
        }
    )
in
    #"Tipos Alterados"

    tabela de itens de linha:

    let
    // 1. Carrega o arquivo JSON do URL
    Fonte = Json.Document(Web.Contents("http://161.35.104.75:8001/download/Hubspot/itens/itens_de_linha_hubspot.json")),
    // 2. Converte a lista em uma tabela
    #"Tabela da Lista" = Table.FromList(Fonte, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
    // 3. Expande as colunas
    #"Colunas Expandidas" = Table.ExpandRecordColumn(
        #"Tabela da Lista", "Column1",
        {"line_item_id", "name", "quantity", "price", "amount", "description", "hs_product_id", "associated_deal_id", "hs_renewal_date", "hs_contract_end_date", "hs_recurring_billing_period", "hs_term_in_months", "hs_recurring_billing_start_date", "hs_recurring_billing_end_date", "hs_billing_period_start_date", "hs_billing_period_end_date", "recurringbillingfrequency", "hs_recurring_billing_terms", "hs_recurring_billing_number_of_payments"},
        {"ID do Item de Linha", "Nome do Item", "Quantidade", "Preço", "Valor Total", "Descrição", "ID do Produto", "ID do Negócio Associado", "Data de Renovação", "Data Fim Contrato", "Período de Cobrança", "Termo em Meses", "Início Cobrança Recorrente", "Fim Cobrança Recorrente", "Início Período Faturamento", "Fim Período Faturamento", "Frequência de Cobrança", "Termos de Cobrança", "Número de Pagamentos"}
    ),
    // 4. Ajusta os tipos de dados
    #"Tipos Alterados" = Table.TransformColumnTypes(
        #"Colunas Expandidas",
        {
            {"Quantidade", Int64.Type},
            {"Preço", Currency.Type},
            {"Valor Total", Currency.Type},
            {"ID do Item de Linha", type text},
            {"ID do Negócio Associado", type text},
            {"Data de Renovação", type date},
            {"Data Fim Contrato", type date},
            {"Período de Cobrança", type text},
            {"Termo em Meses", Int64.Type},
            {"Início Cobrança Recorrente", type date},
            {"Fim Cobrança Recorrente", type date},
            {"Início Período Faturamento", type date},
            {"Fim Período Faturamento", type date},
            {"Frequência de Cobrança", type text},
            {"Termos de Cobrança", type text},
            {"Número de Pagamentos", Int64.Type}
        }
    ),
    #"Coluna Condicional Adicionada" = Table.AddColumn(#"Tipos Alterados", "Luis cubinha", each if [Quantidade] > 30 then 30 else [Quantidade]),
    #"Tipo Alterado" = Table.TransformColumnTypes(#"Coluna Condicional Adicionada",{{"Luis cubinha", Int64.Type}}),
    #"Erros Removidos" = Table.RemoveRowsWithErrors(#"Tipo Alterado", {"Luis cubinha"}),
    #"Linhas Classificadas" = Table.Sort(#"Erros Removidos",{{"Luis cubinha", Order.Descending}}),
    #"Colunas Renomeadas" = Table.RenameColumns(#"Linhas Classificadas",{{"Luis cubinha", "Posições Validas"}})
in
    #"Colunas Renomeadas"


    Medidas: 

    Média Posições (Competidores) = 
DIVIDE(
    [Posições Válidas],
    [Vendedores na Competição]
)

Nome 1º Lugar = 
CALCULATE(
    SELECTEDVALUE('Proprietario'[Nome Completo]),
    FILTER(
        ALL('Proprietario'[Nome Completo]),
        [Ranking Vendedores] = 1
    )
)

Nome 2º Lugar = 
CALCULATE(
    SELECTEDVALUE('Proprietario'[Nome Completo]),
    FILTER(
        ALL('Proprietario'[Nome Completo]),
        [Ranking Vendedores] = 2
    )
)

Nome 3º Lugar = 
CALCULATE(
    SELECTEDVALUE('Proprietario'[Nome Completo]),
    FILTER(
        ALL('Proprietario'[Nome Completo]),
        [Ranking Vendedores] = 3
    )
)


Pontuação 1º Lugar = 
CALCULATE(
    [Posições Válidas],
    FILTER(
        ALL('Proprietario'[Nome Completo]),
        [Ranking Vendedores] = 1
    )
)

Pontuação 2º Lugar = 
CALCULATE(
    [Posições Válidas],
    FILTER(
        ALL('Proprietario'[Nome Completo]),
        [Ranking Vendedores] = 2
    )
)

Pontuação 3º Lugar = 
CALCULATE(
    [Posições Válidas],
    FILTER(
        ALL('Proprietario'[Nome Completo]),
        [Ranking Vendedores] = 3
    )
)

Posições Válidas = SUM('Itens de Linha'[Posições Validas])

Ranking Vendedores = 
RANKX(
    ALL('Proprietario'[Nome Completo]),
    [Posições Válidas],
    ,
    DESC,
    Dense
)

Status Competição = 
VAR Meta = 105
VAR FaltamParaMeta = Meta - [Posições Válidas]
RETURN
IF(
    FaltamParaMeta <= 0,
    "✅ Dentro da Competição",
    "Faltam " & FaltamParaMeta & " posições para competição"
)

Vendedores na Competição = 
COUNTROWS(
    FILTER(
        VALUES('Proprietario'[Nome Completo]),
        [Posições Válidas] > 0
    )
)
Posições Válidas (Medida) = 
SUMX(
    'Itens de Linha',
    IF('Itens de Linha'[Quantidade] > 30, 30, 'Itens de Linha'[Quantidade])
)

Soma Simples Quantidade = SUM('Itens de Linha'[Quantidade])


Total do contrato = 'Itens de Linha'[Valor Total]*'Itens de Linha'[Número de Pagamentos]

Seats para Competição = MIN('Negócios'[Qtd Posições de Trabalho], 30)



Status Competição Vendedores = 
VAR Meta = 105
VAR TotalSeats = SUM('Itens de Linha'[Quantidade]) // Reutilizando a medida que já criamos
VAR FaltamParaMeta = Meta - TotalSeats
RETURN
IF(
    FaltamParaMeta <= 0,
    "✅ Dentro da Competição",
    "Faltam " & FaltamParaMeta & " posições para competição"
)


